import{d as N,f as F,b as O,h as o,i as y,n as I,w as t,k as e,j,m as p,t as i,F as D,p as C,y as P,l as a,A as E,_ as Y,a6 as H,C as R,u as J,r as L,N as W,U as G}from"./index.66cc4c36.js";import{f as K,g as X,h as Z,i as ee}from"./query.116a3d4d.js";import{P as te}from"./pageHeader.9328b4bb.js";import{C as ae}from"./common.b6c75224.js";import{a as z,c as oe}from"./index.187d93a7.js";import{a as le,b as re}from"./index.d3546514.js";const ne={class:"state_color"},se=P("br",null,null,-1),ue=N({__name:"queryProfile",setup(B,{expose:q}){const{t:d}=F(),{pagination:n,is_open:b}=ae(),m=[{title:"SQL",dataIndex:"sql"},{title:d("common.table.source"),dataIndex:"source"},{title:d("common.table.schema"),dataIndex:"schema"},{title:d("common.table.time"),dataIndex:"time"},{title:d("common.table.ex_time"),dataIndex:"ex_time"}],S=O([]),s=O({}),x=async()=>{await K(s.value.work_id)},l=async()=>{await X(s.value.work_id)},u=async r=>{const{data:c}=await Z(s.value.work_id,r);S.value=c.payload.data,n.pageCount=c.payload.page};return q({profile:r=>{s.value=r,b.value=!0,u(n.current)}}),(r,c)=>{const g=o("a-button"),k=o("a-descriptions-item"),U=o("a-descriptions"),_=o("a-col"),w=o("a-progress"),$=o("a-row"),f=o("a-table"),T=o("a-pagination"),A=o("a-tab-pane"),M=o("a-tabs"),Q=o("a-page-header"),V=o("a-drawer");return y(),I(V,{visible:a(b),"onUpdate:visible":c[2]||(c[2]=h=>E(b)?b.value=h:null),"header-style":{display:"none"},"body-style":{padding:0}},{default:t(()=>[e(Q,{title:r.$t("order.profile.work_id",{id:s.value.work_id}),ghost:!1},{extra:t(()=>[s.value.status===1?(y(),j(D,{key:0},[e(g,{key:"2",danger:"",ghost:"",onClick:l},{default:t(()=>[p(i(r.$t("order.reject")),1)]),_:1}),e(g,{key:"1",type:"primary",onClick:x},{default:t(()=>[p(i(r.$t("order.agree")),1)]),_:1})],64)):C("v-if",!0)]),default:t(()=>[e($,{type:"flex",justify:"center",align:"middle"},{default:t(()=>[e(_,{span:16},{default:t(()=>[e(U,{column:2},{default:t(()=>[e(k,{label:r.$t("query.profile.username")},{default:t(()=>[p(i(s.value.username),1)]),_:1},8,["label"]),e(k,{label:r.$t("query.profile.realname")},{default:t(()=>[p(i(s.value.real_name),1)]),_:1},8,["label"]),e(k,{label:r.$t("query.profile.export")},{default:t(()=>[p(i(s.value.export===1?r.$t("common.yes"):r.$t("common.no")),1)]),_:1},8,["label"]),e(k,{label:r.$t("query.profile.date")},{default:t(()=>[p(i(s.value.date),1)]),_:1},8,["label"]),e(k,{label:r.$t("query.profile.text")},{default:t(()=>[P("span",null,i(s.value.text),1)]),_:1},8,["label"]),e(k,{label:r.$t("query.profile.approval")},{default:t(()=>[p(i(s.value.approval_time),1)]),_:1},8,["label"])]),_:1})]),_:1}),e(_,{span:8},{default:t(()=>[e(w,{percent:100,"stroke-width":5,width:150,"stroke-color":a(z)(s.value.status).color,type:"circle",style:{position:"relative"}},{format:t(()=>[P("span",ne,i(a(z)(s.value.status).title),1)]),_:1},8,["stroke-color"])]),_:1})]),_:1}),e(M,null,{default:t(()=>[e(A,{key:"1",tab:r.$t("order.profile.profile")},{default:t(()=>[e(f,{bordered:"",columns:m,"data-source":S.value,size:"small",pagination:!1},null,8,["data-source"]),se,e(T,{"page-size":a(n).pageSize,"onUpdate:pageSize":c[0]||(c[0]=h=>a(n).pageSize=h),current:a(n).current,"onUpdate:current":c[1]||(c[1]=h=>a(n).current=h),total:a(n).pageCount,"show-total":h=>`\u5171 ${h} \u6761`,onChange:u},null,8,["page-size","current","total","show-total"])]),_:1},8,["tab"])]),_:1})]),_:1},8,["title"])]),_:1},8,["visible"])}}}),ie=Y(ue,[["__file","F:/inf/Yearning/gemini-next/src/components/queryProfile/queryProfile.vue"]]),de={class:"table-page-search-wrapper"},ce=N({__name:"querySearch",emits:["search"],setup(B,{emit:q}){const d=q;let n=O({username:"",status:7,work_id:"",export:0,real_name:""});const b=Object.assign({},n.value),m=O(!1),S=()=>{n.value=Object.assign({},b),d("search",a(b))},s=()=>{d("search",n.value)},x=()=>{m.value=!m.value};return(l,u)=>{const v=o("a-input"),r=o("a-form-item"),c=o("a-col"),g=o("a-select-option"),k=o("a-select"),U=o("a-range-picker"),_=o("a-button"),w=o("a-row"),$=o("a-form");return y(),j("div",de,[e($,null,{default:t(()=>[e(w,{gutter:12},{default:t(()=>[e(c,{xs:24,sm:8},{default:t(()=>[e(r,{label:l.$t("order.query.table.work_id")},{default:t(()=>[e(v,{value:a(n).work_id,"onUpdate:value":u[0]||(u[0]=f=>a(n).work_id=f)},null,8,["value"])]),_:1},8,["label"])]),_:1}),e(c,{xs:24,sm:8},{default:t(()=>[e(r,{label:l.$t("order.query.table.username")},{default:t(()=>[e(v,{value:a(n).username,"onUpdate:value":u[1]||(u[1]=f=>a(n).username=f)},null,8,["value"])]),_:1},8,["label"])]),_:1}),m.value?(y(),j(D,{key:0},[e(c,{xs:24,sm:8},{default:t(()=>[e(r,{label:l.$t("order.query.table.status")},{default:t(()=>[e(k,{value:a(n).status,"onUpdate:value":u[2]||(u[2]=f=>a(n).status=f)},{default:t(()=>[e(g,{value:7},{default:t(()=>[p(i(l.$t("common.all")),1)]),_:1}),e(g,{value:1},{default:t(()=>[p(i(l.$t("order.state.audit")),1)]),_:1}),e(g,{value:2},{default:t(()=>[p(i(l.$t("order.query.audit.state.process")),1)]),_:1}),e(g,{value:3},{default:t(()=>[p(i(l.$t("order.query.audit.state.done")),1)]),_:1}),e(g,{value:4},{default:t(()=>[p(i(l.$t("order.state.reject")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"])]),_:1}),e(c,{xs:24,sm:8},{default:t(()=>[e(r,{label:l.$t("order.query.table.real_name")},{default:t(()=>[e(v,{value:a(n).real_name,"onUpdate:value":u[3]||(u[3]=f=>a(n).real_name=f)},null,8,["value"])]),_:1},8,["label"])]),_:1}),e(c,{xs:24,sm:8},{default:t(()=>[e(r,{label:l.$t("order.query.table.time")},{default:t(()=>[e(U,{value:a(n).picker,"onUpdate:value":u[4]||(u[4]=f=>a(n).picker=f),format:"YYYY-MM-DD HH:mm","show-time":"",ranges:{"This week":[a(R)().startOf("week"),a(R)().endOf("week")],"This month":[a(R)().startOf("month"),a(R)().endOf("month")]}},null,8,["value","ranges"])]),_:1},8,["label"])]),_:1})],64)):C("v-if",!0),e(c,{xs:24,sm:8},{default:t(()=>[P("span",{class:"table-page-search-submitButtons",style:H(m.value&&{overflow:"hidden"}||{})},[e(_,{type:"primary",onClick:s},{default:t(()=>[p(i(l.$t("common.search")),1)]),_:1}),e(_,{style:{"margin-left":"8px"},onClick:S},{default:t(()=>[p(i(l.$t("common.cancel")),1)]),_:1}),P("a",{style:{"margin-left":"8px"},onClick:x},i(m.value?l.$t("common.pick"):l.$t("common.unfold")),1)],4)]),_:1})]),_:1})]),_:1})])}}});const pe=Y(ce,[["__scopeId","data-v-2eb2f1fe"],["__file","F:/inf/Yearning/gemini-next/src/views/server/query/querySearch.vue"]]),me={key:2},_e=N({__name:"list",props:{isRecord:{type:Boolean,required:!1,default:!1},size:{type:String,required:!1,default:"default"}},setup(B){const q=B,{t:d}=F(),n=J(),b=O(),m=O(),{width:S}=le(m),s=L({col:[{title:d("order.query.table.work_id"),dataIndex:"work_id"},{title:d("order.query.table.username"),dataIndex:"username"},{title:d("order.query.table.real_name"),dataIndex:"real_name"},{title:d("order.query.table.time"),dataIndex:"date"},{title:d("order.query.table.export"),dataIndex:"export"},{title:d("order.query.table.status"),dataIndex:"status"},{title:d("common.action"),dataIndex:"action"}],data:[],pageCount:0,defaultPageSize:20,isloop:!0,expr:{work_id:"",username:"",status:7},websocket:re(`${oe()}/api/v2/audit/query/list?tp=${q.isRecord?"record":"order"}`,{autoReconnect:{retries:3,delay:1e3,onFailed(){W.error(d("query.ws.error"))}},protocols:[n.state.user.account.token],onMessage:(l,u)=>{let v=JSON.parse(u.data);s.data=v.payload.data,s.pageCount=v.payload.page}}),fn:async l=>{var u;(u=s.websocket)==null||u.send(JSON.stringify(l))}}),x={title:d("order.query.title"),subTitle:d("order.query.desc")};return(l,u)=>{const v=o("a-button"),r=o("a-popconfirm"),c=o("a-space"),g=o("a-tag"),k=o("c-table"),U=o("a-card");return y(),j("div",null,[q.isRecord?C("v-if",!0):(y(),I(te,{key:0,title:x.title,"sub-title":x.subTitle},null,8,["title","sub-title"])),e(U,null,{default:t(()=>[e(pe,{onSearch:u[0]||(u[0]=_=>{s.expr=_,m.value.manual()})}),e(k,{ref_key:"tbl",ref:m,"tbl-ref":s,size:q.size},{bodyCell:t(({column:_,text:w,record:$})=>[_.dataIndex==="action"?(y(),I(c,{key:0},{default:t(()=>[$.status===2&&!q.isRecord?(y(),I(r,{key:0,title:l.$t("order.query.audit.end.tips"),onConfirm:()=>a(ee)($.work_id).then(()=>m.value.manual())},{default:t(()=>[e(v,{size:"small",danger:""},{default:t(()=>[p(i(l.$t("order.end")),1)]),_:1})]),_:2},1032,["title","onConfirm"])):C("v-if",!0),e(v,{size:"small",type:"primary",onClick:()=>b.value.profile($)},{default:t(()=>[p(i(l.$t("common.profile")),1)]),_:2},1032,["onClick"])]),_:2},1024)):C("v-if",!0),_.dataIndex==="status"?(y(),I(g,{key:1,color:a(z)(w).color},{icon:t(()=>[(y(),I(G(a(z)(w).icon),{spin:a(z)(w).color==="#408B9B"},null,8,["spin"]))]),default:t(()=>[p(" "+i(a(z)(w).title),1)]),_:2},1032,["color"])):C("v-if",!0),_.dataIndex==="export"?(y(),j("span",me,i(w===0?l.$t("common.no"):l.$t("common.yes")),1)):C("v-if",!0)]),_:1},8,["tbl-ref","size"])]),_:1}),e(ie,{ref_key:"profile",ref:b,width:a(S)},null,8,["width"])])}}}),we=Y(_e,[["__file","F:/inf/Yearning/gemini-next/src/views/server/query/list.vue"]]);export{we as default};
