import{d as H,b as z,f as X,o as Z,ak as le,h as u,i as s,n as f,w as t,k as a,m as r,t as i,j as k,B as N,l as C,F as b,A as ne,N as V,al as se,am as ue,an as re,p as S,y as R,_ as G,r as Q,a6 as ie,ao as ce,ap as de,aq as W}from"./index.66cc4c36.js";import{P as pe}from"./pageHeader.9328b4bb.js";import{C as me}from"./common.b6c75224.js";const fe=R("br",null,null,-1),ve={style:{"margin-top":"2%"}},_e=H({__name:"flowModal",props:{title:{type:String,required:!0}},emits:["success"],setup(D,{expose:v,emit:y}){const I=D,B=z(),{t:c}=X(),U=y,l=z({steps:[{desc:c("flow.commit"),auditor:[c("flow.applicant")],type:-1}]}),p=z({});let F=z([]);const{is_open:n,turnState:_}=me(),g={desc:[{required:!0,trigger:"blur",message:c("common.check.flow")}],type:[{required:!0,trigger:"change",message:c("common.check.type")}],auditor:[{required:!0,trigger:"change",message:c("common.check.auditor")}]},O=()=>{if(p.value.type===1){for(let e of l.value.steps)if(e.type===1){V.error(c("flow.execute.tips"));return}}if(l.value.steps.length===7){V.error(c("flow.audit.tips"));return}B.value.validateFields().then(()=>{l.value.steps.push(Object.assign({},p.value)),p.value={}})},E=e=>{if(e-1==0){V.error(c("flow.commit.tips"));return}l.value.steps[e]=l.value.steps.splice(e-1,1,l.value.steps[e])[0]},Y=e=>{e+1!=l.value.steps.length&&(l.value.steps[e]=l.value.steps.splice(e+1,1,l.value.steps[e])[0])},j=e=>{l.value.steps.splice(e,1)},w=async()=>{if(l.value.steps[l.value.steps.length-1].type!==1){V.error(c("flow.save.tips"));return}await se(l.value),_(),U("success")},$=e=>{l.value=Object.assign({},e),_()},q=()=>{p.value={},l.value.id=-1,l.value.steps=[{desc:c("flow.commit"),auditor:[c("flow.applicant")],type:-1}],l.value.source="",_()};return Z(async()=>{const{data:e}=await le();F.value=e.payload}),v({newFlow:q,editFlow:$}),(e,d)=>{const h=u("a-input"),P=u("a-form-item"),K=u("a-divider"),L=u("a-select-option"),A=u("a-select"),T=u("a-button"),x=u("a-form"),J=u("a-col"),ee=u("a-space"),te=u("a-tag"),ae=u("a-row"),oe=u("a-modal");return s(),f(oe,{visible:C(n),"onUpdate:visible":d[4]||(d[4]=o=>ne(n)?n.value=o:null),title:I.title,width:800,"ok-text":e.$t("common.save"),onOk:w},{default:t(()=>[a(ae,null,{default:t(()=>[a(J,{span:10},{default:t(()=>[a(x,{ref_key:"formRef",ref:B,model:p.value,rules:g},{default:t(()=>[a(P,{label:e.$t("menu.manage.flow")+e.$t("common.table.name"),required:""},{default:t(()=>[a(h,{value:l.value.source,"onUpdate:value":d[0]||(d[0]=o=>l.value.source=o)},null,8,["value"])]),_:1},8,["label"]),a(K,{orientation:"left"},{default:t(()=>[r(i(e.$t("flow.step")),1)]),_:1}),a(P,{label:e.$t("flow.step")+e.$t("common.table.name"),name:"desc"},{default:t(()=>[a(h,{value:p.value.desc,"onUpdate:value":d[1]||(d[1]=o=>p.value.desc=o)},null,8,["value"])]),_:1},8,["label"]),a(P,{label:e.$t("flow.step")+e.$t("common.table.type"),name:"type"},{default:t(()=>[a(A,{value:p.value.type,"onUpdate:value":d[2]||(d[2]=o=>p.value.type=o)},{default:t(()=>[a(L,{value:0},{default:t(()=>[r(i(e.$t("flow.audit")),1)]),_:1}),a(L,{value:1},{default:t(()=>[r(i(e.$t("flow.execute")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),a(P,{label:e.$t("flow.auditor"),name:"auditor"},{default:t(()=>[a(A,{value:p.value.auditor,"onUpdate:value":d[3]||(d[3]=o=>p.value.auditor=o),mode:"multiple"},{default:t(()=>[(s(!0),k(b,null,N(C(F),o=>(s(),f(L,{key:o.username,value:o.username},{default:t(()=>[r(i(o.username),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),a(P,{label:e.$t("common.action")},{default:t(()=>[a(T,{type:"primary",style:{"margin-left":"10%"},onClick:O},{default:t(()=>[r(i(e.$t("common.add")),1)]),_:1})]),_:1},8,["label"])]),_:1},8,["model"])]),_:1}),a(J,{span:13,offset:1},{default:t(()=>[a(C(ue),{direction:"vertical","progress-dot":"",size:"small",current:0},{default:t(()=>[(s(!0),k(b,null,N(l.value.steps,(o,M)=>(s(),f(C(re),{key:M,title:`${o.desc} ${o.type===1?`(${e.$t("flow.execute")+" "+e.$t("flow.phase")})`:o.type===0?`(${e.$t("flow.audit")+" "+e.$t("flow.phase")})`:""}`,class:"empty"},{description:t(()=>[o.type!==-1?(s(),k(b,{key:0},[a(ee,null,{default:t(()=>[o.edit?(s(),f(T,{key:1,ghost:"",size:"small",onClick:m=>o.edit=!1},{default:t(()=>[r(i(e.$t("common.save")),1)]),_:2},1032,["onClick"])):(s(),f(T,{key:0,ghost:"",size:"small",onClick:m=>o.edit=!0},{default:t(()=>[r(i(e.$t("common.edit")),1)]),_:2},1032,["onClick"])),o.edit?S("v-if",!0):(s(),f(T,{key:2,ghost:"",size:"small",onClick:m=>j(M)},{default:t(()=>[r(i(e.$t("common.delete")),1)]),_:2},1032,["onClick"])),o.edit?S("v-if",!0):(s(),f(T,{key:3,ghost:"",size:"small",onClick:m=>E(M)},{default:t(()=>[r(i(e.$t("flow.up")),1)]),_:2},1032,["onClick"])),o.edit?S("v-if",!0):(s(),f(T,{key:4,ghost:"",size:"small",onClick:m=>Y(M)},{default:t(()=>[r(i(e.$t("flow.down")),1)]),_:2},1032,["onClick"]))]),_:2},1024),fe],64)):S("v-if",!0),R("div",ve,[(s(!0),k(b,null,N(o.auditor,m=>(s(),k(b,{key:m},[o.edit?S("v-if",!0):(s(),f(te,{key:0,color:"#108ee9"},{default:t(()=>[r(i(m),1)]),_:2},1024))],64))),128)),o.edit?(s(),f(A,{key:0,value:o.auditor,"onUpdate:value":m=>o.auditor=m,mode:"multiple",style:{width:"100%"}},{default:t(()=>[(s(!0),k(b,null,N(C(F),m=>(s(),f(L,{key:m.username,value:m.username},{default:t(()=>[r(i(m.username),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value"])):S("v-if",!0)])]),_:2},1032,["title"]))),128))]),_:1})]),_:1})]),_:1})]),_:1},8,["visible","title","ok-text"])}}}),we=G(_e,[["__file","F:/inf/Yearning/gemini-next/src/views/manager/flow/flowModal.vue"]]),ge=R("br",null,null,-1),ye=R("br",null,null,-1),$e={style:{padding:"8px"}},he=H({__name:"flowTable",setup(D){const{t:v}=X(),y=Q({col:[{title:v("menu.manage.flow")+v("common.table.name"),dataIndex:"source",customFilterDropdown:!0,onFilter:(n,_)=>_.source.toString().toLowerCase().includes(n.toLowerCase()),onFilterDropdownVisibleChange:n=>{n&&setTimeout(()=>{I.value.focus()},100)}},{title:v("common.action"),dataIndex:"action"}],data:[],pageCount:0}),I=z(),B=z(v("common.new")+v("menu.manage.flow")),c=z(),U=Q({searchText:"",searchedColumn:""}),l=(n,_,g)=>{_(),U.searchText=n[0],U.searchedColumn=g},p=n=>{n(),U.searchText=""},F=async()=>{const{data:n}=await ce();y.data=n.payload,y.pageCount=n.payload.length};return Z(()=>{F()}),(n,_)=>{const g=u("a-button"),O=u("a-popconfirm"),E=u("a-space"),Y=u("a-input"),j=u("a-table");return s(),k(b,null,[a(g,{type:"primary",onClick:_[0]||(_[0]=w=>c.value.newFlow())},{default:t(()=>[r(i(n.$t("common.new"))+i(n.$t("menu.manage.flow")),1)]),_:1}),ge,ye,a(j,{columns:y.col,"data-source":y.data,bordered:"",pagination:{total:y.pageCount,showTotal:w=>n.$t("common.count",{count:w}),position:["bottomLeft"],showSizeChanger:!0,defaultPageSize:10}},{bodyCell:t(({column:w,record:$})=>[w.dataIndex==="action"?(s(),f(E,{key:0,size:"small"},{default:t(()=>[a(g,{type:"primary",size:"small",ghost:"",onClick:q=>c.value.editFlow($)},{default:t(()=>[r(i(n.$t("common.profile")),1)]),_:2},1032,["onClick"]),a(O,{title:n.$t("flow.delete.tips"),onConfirm:()=>C(de)($.id).finally(()=>F())},{default:t(()=>[a(g,{type:"primary",size:"small",danger:"",ghost:""},{default:t(()=>[r(i(n.$t("common.delete")),1)]),_:1})]),_:2},1032,["title","onConfirm"])]),_:2},1024)):S("v-if",!0)]),customFilterDropdown:t(({setSelectedKeys:w,selectedKeys:$,confirm:q,clearFilters:e,column:d})=>[R("div",$e,[a(Y,{ref_key:"searchInput",ref:I,placeholder:`Search ${d.dataIndex}`,value:$[0],style:{width:"188px","margin-bottom":"8px",display:"block"},onChange:h=>w(h.target.value?[h.target.value]:[]),onPressEnter:h=>l($,q,d.dataIndex)},null,8,["placeholder","value","onChange","onPressEnter"]),a(g,{type:"primary",size:"small",style:{width:"90px","margin-right":"8px"},onClick:h=>l($,q,d.dataIndex)},{icon:t(()=>[a(C(W))]),default:t(()=>[r(" Search ")]),_:2},1032,["onClick"]),a(g,{size:"small",style:{width:"90px"},onClick:h=>p(e)},{default:t(()=>[r("Reset")]),_:2},1032,["onClick"])])]),customFilterIcon:t(({filtered:w})=>[a(C(W),{style:ie({color:w?"#108ee9":void 0})},null,8,["style"])]),_:1},8,["columns","data-source","pagination"]),a(we,{ref_key:"flow",ref:c,title:B.value,onSuccess:F},null,8,["title"])],64)}}}),ke=G(he,[["__file","F:/inf/Yearning/gemini-next/src/views/manager/flow/flowTable.vue"]]),be=H({__name:"flow",setup(D){return(v,y)=>{const I=u("a-card");return s(),k(b,null,[a(pe,{title:v.$t("menu.manage.flow"),"sub-title":v.$t("common.flow.sub")},null,8,["title","sub-title"]),a(I,null,{default:t(()=>[a(ke)]),_:1})],64)}}}),ze=G(be,[["__file","F:/inf/Yearning/gemini-next/src/views/manager/flow/flow.vue"]]);export{ze as default};
