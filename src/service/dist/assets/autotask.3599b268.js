import{J as R,K as P,d as V,f as Y,b as q,r as D,o as X,h as s,i as c,n as g,w as t,k as l,j as y,B as L,l as $,F as h,A as Z,m as p,t as f,_ as z,p as N,y as ee}from"./index.66cc4c36.js";import{P as ae}from"./pageHeader.9328b4bb.js";import{C as E}from"./common.b6c75224.js";import{f as te,q as le,c as ne,a as oe}from"./source.09d3a396.js";function ue(v){return R.put(`${P}/manage/task`,v)}function H(v,u){return v==="curd"&&(u.source_id=u.sourceLabel.value,u.source=u.sourceLabel.label),R.post(`${P}/manage/task`,{task:u,tp:v})}function se(v){return R.delete(`${P}/manage/task?task_id=${v}`)}const ce=V({__name:"autotaskModal",emits:["success"],setup(v,{expose:u,emit:d}){const{t:m}=Y(),b=q(),i=D({source:[],idc:[],schema:[],tables:[]}),n=q({name:"",tp:0,sourceLabel:{},data_base:"",table:"",affect_rows:0,idc:""}),r=async(o,a)=>a.value===void 0?Promise.reject(m("common.check.source")):Promise.resolve(),w={name:[{required:!0,trigger:"blur",message:m("common.check.name")}],idc:[{required:!0,trigger:"change",message:m("common.check.env")}],sourceLabel:[{required:!0,trigger:"change",validator:r}],data_base:[{required:!0,trigger:"change",message:m("common.check.schema")}],table:[{required:!0,trigger:"change",message:m("common.check.table")}]},U=Object.assign({},n),S=d,{is_open:C,turnState:T,taskTp:M}=E(),O=()=>{Object.assign(n,$(U)),T()},A=o=>{n.value=Object.assign({},o),T()},F=()=>{b.value.validateFields().then(async()=>{await H("curd",n.value),T(),S("success")})},j=async o=>{const{data:a}=await le("idc",o);i.source=a.payload},_=async o=>{const{data:a}=await ne(o.value);i.schema=a.payload},B=async o=>{const{data:a}=await oe(n.value.sourceLabel.value,o);i.tables=a.payload};return X(async()=>{const{data:o}=await te();i.idc=o.payload}),u({newTask:O,editTask:A}),(o,a)=>{const J=s("a-input"),k=s("a-form-item"),x=s("a-select-option"),I=s("a-select"),K=s("a-input-number"),G=s("a-switch"),Q=s("a-form"),W=s("a-modal");return c(),g(W,{visible:$(C),"onUpdate:visible":a[8]||(a[8]=e=>Z(C)?C.value=e:null),title:o.$t("auto.title"),onOk:F},{default:t(()=>[l(Q,{ref_key:"formRef",ref:b,layout:"vertical",model:n.value,rules:w},{default:t(()=>[l(k,{label:o.$t("auto.edit.name"),name:"name"},{default:t(()=>[l(J,{value:n.value.name,"onUpdate:value":a[0]||(a[0]=e=>n.value.name=e)},null,8,["value"])]),_:1},8,["label"]),l(k,{label:o.$t("common.table.type")},{default:t(()=>[l(I,{value:n.value.tp,"onUpdate:value":a[1]||(a[1]=e=>n.value.tp=e)},{default:t(()=>[(c(!0),y(h,null,L($(M),e=>(c(),g(x,{key:e.v,value:e.v},{default:t(()=>[p(f(e.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),l(k,{label:o.$t("common.table.env"),name:"idc"},{default:t(()=>[l(I,{value:n.value.idc,"onUpdate:value":a[2]||(a[2]=e=>n.value.idc=e),onChange:j},{default:t(()=>[(c(!0),y(h,null,L(i.idc,e=>(c(),g(x,{key:e,value:e},{default:t(()=>[p(f(e),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),l(k,{label:o.$t("common.table.source"),name:"sourceLabel"},{default:t(()=>[l(I,{value:n.value.sourceLabel,"onUpdate:value":a[3]||(a[3]=e=>n.value.sourceLabel=e),"label-in-value":"","option-label-prop":"label",onChange:_},{default:t(()=>[(c(!0),y(h,null,L(i.source,e=>(c(),g(x,{key:e.source_id,value:e.source_id,label:e.source},{default:t(()=>[p(f(e.source),1)]),_:2},1032,["value","label"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),l(k,{label:o.$t("common.table.schema"),name:"data_base"},{default:t(()=>[l(I,{value:n.value.data_base,"onUpdate:value":a[4]||(a[4]=e=>n.value.data_base=e),onChange:B},{default:t(()=>[(c(!0),y(h,null,L(i.schema,e=>(c(),g(x,{key:e,value:e},{default:t(()=>[p(f(e),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),l(k,{label:o.$t("common.table.table"),name:"table"},{default:t(()=>[l(I,{value:n.value.table,"onUpdate:value":a[5]||(a[5]=e=>n.value.table=e)},{default:t(()=>[(c(!0),y(h,null,L(i.tables,e=>(c(),g(x,{key:e,value:e},{default:t(()=>[p(f(e),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),l(k,{label:o.$t("common.table.max")},{default:t(()=>[l(K,{value:n.value.affect_rows,"onUpdate:value":a[6]||(a[6]=e=>n.value.affect_rows=e),min:0},null,8,["value"])]),_:1},8,["label"]),l(k,{label:o.$t("auto.edit.enabled")},{default:t(()=>[l(G,{checked:n.value.status,"onUpdate:checked":a[7]||(a[7]=e=>n.value.status=e),"checked-value":1,"un-checked-value":0},null,8,["checked"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["visible","title"])}}}),re=z(ce,[["__file","F:/inf/Yearning/gemini-next/src/views/manager/autotask/autotaskModal.vue"]]),ie=ee("br",null,null,-1),de=V({__name:"autotaskTable",setup(v){const{t:u}=Y(),d=D({col:[{title:u("common.table.name"),dataIndex:"name"},{title:u("common.table.type"),dataIndex:"tp"},{title:u("common.table.env"),dataIndex:"idc"},{title:u("common.table.source"),dataIndex:"source"},{title:u("common.table.schema"),dataIndex:"data_base"},{title:u("common.table.table"),dataIndex:"table"},{title:u("common.table.max"),dataIndex:"affect_rows"},{title:u("common.table.state"),dataIndex:"status"},{title:u("common.action"),dataIndex:"action"}],data:[],pageCount:0,expr:{},fn:async n=>{const{data:r}=await ue(n);d.data=r.payload.data,d.pageCount=r.payload.page}}),m=q(),b=q(),{taskTp:i}=E();return(n,r)=>{const w=s("a-button"),U=s("a-form-item"),S=s("a-input-search"),C=s("a-form"),T=s("a-col"),M=s("a-row"),O=s("a-popconfirm"),A=s("a-space"),F=s("a-switch"),j=s("c-table");return c(),y(h,null,[l(M,null,{default:t(()=>[l(T,{span:24},{default:t(()=>[l(C,{layout:"inline"},{default:t(()=>[l(U,null,{default:t(()=>[l(w,{type:"primary",onClick:r[0]||(r[0]=_=>m.value.newTask())},{default:t(()=>[p(f(n.$t("auto.create")),1)]),_:1})]),_:1}),l(U,null,{default:t(()=>[l(S,{value:d.expr.text,"onUpdate:value":r[1]||(r[1]=_=>d.expr.text=_),placeholder:n.$t("auto.search.tips"),"enter-button":"","allow-clear":"",onSearch:r[2]||(r[2]=_=>b.value.manual())},null,8,["value","placeholder"])]),_:1})]),_:1})]),_:1})]),_:1}),ie,l(j,{ref_key:"tbl",ref:b,"tbl-ref":d},{bodyCell:t(({column:_,text:B,record:o})=>[_.dataIndex==="action"?(c(),g(A,{key:0},{default:t(()=>[l(w,{ghost:"",size:"small",onClick:a=>m.value.editTask(o)},{default:t(()=>[p(f(n.$t("common.edit")),1)]),_:2},1032,["onClick"]),l(O,{title:n.$t("auto.delete.tips"),onConfirm:a=>$(se)(o.task_id).then(()=>b.value.manual())},{default:t(()=>[l(w,{ghost:"",size:"small",danger:""},{default:t(()=>[p(f(n.$t("common.delete")),1)]),_:1})]),_:2},1032,["title","onConfirm"])]),_:2},1024)):N("v-if",!0),_.dataIndex==="tp"?(c(),y(h,{key:1},[p(f($(i).filter(a=>a.v===B)[0].title),1)],64)):N("v-if",!0),_.dataIndex==="status"?(c(),g(F,{key:2,checked:o.status,"onUpdate:checked":a=>o.status=a,"checked-value":1,"un-checked-value":0,onChange:()=>$(H)("active",o)},null,8,["checked","onUpdate:checked","onChange"])):N("v-if",!0)]),_:1},8,["tbl-ref"]),l(re,{ref_key:"p",ref:m,onSuccess:r[3]||(r[3]=_=>b.value.manual())},null,512)],64)}}}),me=z(de,[["__file","F:/inf/Yearning/gemini-next/src/views/manager/autotask/autotaskTable.vue"]]),_e=V({__name:"autotask",setup(v){const{t:u}=Y(),d={title:u("auto.title"),subTitle:u("auto.desc")};return(m,b)=>{const i=s("a-card");return c(),y(h,null,[l(ae,{title:d.title,"sub-title":d.subTitle},null,8,["title","sub-title"]),l(i,null,{default:t(()=>[l(me)]),_:1})],64)}}}),ke=z(_e,[["__file","F:/inf/Yearning/gemini-next/src/views/manager/autotask/autotask.vue"]]);export{ke as default};
