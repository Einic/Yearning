import{J as h,K as q,d as I,b as w,r as S,o as Y,h as a,i as y,n as D,w as l,k as o,j as C,B as j,F as k,l as F,A as x,_ as N,f as z,m as L,t as v,p as K,y as A}from"./index.66cc4c36.js";import{P as H}from"./pageHeader.9328b4bb.js";import{C as J}from"./common.b6c75224.js";function Q(s){return h.put(`${q}/manage/policy`,s)}function G(){return h.get(`${q}/manage/policy/source`)}function W(s){return h.post(`${q}/manage/policy`,s)}function X(s){return h.delete(`${q}/manage/policy?group_id=${s}`)}var T=(s=>(s.DDL="ddl",s.DML="dml",s.QUERY="query",s))(T||{});const Z=I({__name:"policyModal",props:{title:{type:String,required:!0}},emits:["success"],setup(s,{expose:c,emit:m}){const p=m,{is_open:u,turnState:d}=J(),P=s,n=w(!1),r=S({source:[],query:[]}),t=S({ddl_source:[],dml_source:[],query_source:[],name:"",id:0});let g=Object.assign({},t);const M=async()=>{await W(t),d(),p("success")},U=e=>{n.value=!0,t.id=e.id,t.name=e.name,e.permissions.query_source===null?t.query_source=[]:t.query_source=e.permissions.query_source,e.permissions.dml_source===null?t.dml_source=[]:t.dml_source=e.permissions.dml_source,e.permissions.ddl_source===null?t.ddl_source=[]:t.ddl_source=e.permissions.ddl_source,d()},B=()=>{n.value=!1,Object.assign(t,F(g)),d()};return Y(async()=>{const{data:e}=await G();r.source=e.payload.source,r.query=e.payload.query}),c({newPolicy:B,editPolicy:U}),(e,_)=>{const R=a("a-input"),E=a("a-form-item"),$=a("a-transfer"),b=a("a-divider"),O=a("a-form"),V=a("a-modal");return y(),D(V,{visible:F(u),"onUpdate:visible":_[1]||(_[1]=i=>x(u)?u.value=i:null),title:P.title,width:800,onOk:M},{default:l(()=>[o(O,{layout:"vertical"},{default:l(()=>[o(E,{label:e.$t("common.policy.group")+e.$t("common.table.name")},{default:l(()=>[o(R,{value:t.name,"onUpdate:value":_[0]||(_[0]=i=>t.name=i),disabled:n.value},null,8,["value","disabled"])]),_:1},8,["label"]),(y(),C(k,null,j(T,i=>(y(),C(k,{key:i},[o($,{"target-keys":t[`${i}_source`],"onUpdate:targetKeys":f=>t[`${i}_source`]=f,titles:[" "+e.$t("common.all")+`${i.toLocaleUpperCase()} `+e.$t("common.policy")," "+e.$t("common.selected")+`${i.toLocaleUpperCase()} `+e.$t("common.policy")],"row-key":f=>f.source_id,"data-source":i==="query"?r.query:r.source,"show-search":"",render:f=>f.source,"list-style":{width:"400px",height:"300px"}},null,8,["target-keys","onUpdate:targetKeys","titles","row-key","data-source","render"]),o(b)],64))),64))]),_:1})]),_:1},8,["visible","title"])}}}),ee=N(Z,[["__file","F:/inf/Yearning/gemini-next/src/views/manager/policy/policyModal.vue"]]),oe=A("br",null,null,-1),te=I({__name:"policyTable",setup(s){const{t:c}=z(),m=S({col:[{title:c("common.policy.group")+c("common.table.name"),dataIndex:"name"},{title:c("common.action"),dataIndex:"action"}],data:[],pageCount:0,expr:{text:""},fn:async n=>{const{data:r}=await Q(n);m.data=r.payload.data,m.pageCount=r.payload.page}}),p=w(),u=w(),d=w(`${c("common.new")+c("common.policy.group")}`),P=n=>{m.expr.text=n,u.value.manual()};return(n,r)=>{const t=a("a-button"),g=a("a-form-item"),M=a("a-input-search"),U=a("a-form"),B=a("a-col"),e=a("a-row"),_=a("a-popconfirm"),R=a("a-space"),E=a("c-table");return y(),C(k,null,[o(e,null,{default:l(()=>[o(B,{span:24},{default:l(()=>[o(U,{layout:"inline"},{default:l(()=>[o(g,null,{default:l(()=>[o(t,{type:"primary",onClick:r[0]||(r[0]=()=>{d.value=`${n.$t("common.new")+n.$t("common.policy.group")}`,p.value.newPolicy()})},{default:l(()=>[L(v(n.$t("common.new"))+v(n.$t("common.policy.group")),1)]),_:1})]),_:1}),o(g,null,{default:l(()=>[o(M,{placeholder:n.$t("common.search")+" "+n.$t("common.policy.group"),"enter-button":"","allow-clear":"",onSearch:P},null,8,["placeholder"])]),_:1})]),_:1})]),_:1})]),_:1}),oe,o(E,{ref_key:"tbl",ref:u,"tbl-ref":m},{bodyCell:l(({column:$,record:b})=>[$.dataIndex==="action"?(y(),D(R,{key:0,size:"small"},{default:l(()=>[o(t,{type:"primary",size:"small",ghost:"",onClick:()=>{d.value=`${n.$t("common.edit")+n.$t("common.policy.group")}`,p.value.editPolicy(b)}},{default:l(()=>[L(v(n.$t("common.profile")),1)]),_:2},1032,["onClick"]),o(_,{title:"\u786E\u8BA4\u8981\u5220\u9664\u8BE5\u6743\u9650\u7EC4\u5417?",onConfirm:O=>F(X)(b.group_id).then(()=>u.value.manual())},{default:l(()=>[o(t,{type:"primary",size:"small",danger:"",ghost:""},{default:l(()=>[L(v(n.$t("common.delete")),1)]),_:1})]),_:2},1032,["onConfirm"])]),_:2},1024)):K("v-if",!0)]),_:1},8,["tbl-ref"]),o(ee,{ref_key:"p",ref:p,title:d.value,onSuccess:r[1]||(r[1]=$=>u.value.manual())},null,8,["title"])],64)}}}),ne=N(te,[["__file","F:/inf/Yearning/gemini-next/src/views/manager/policy/policyTable.vue"]]),ae=I({__name:"policy",setup(s){return(c,m)=>{const p=a("a-card");return y(),C(k,null,[o(H,{title:c.$t("menu.manage.policy"),"sub-title":c.$t("common.policy.sub")},null,8,["title","sub-title"]),o(p,null,{default:l(()=>[o(ne)]),_:1})],64)}}}),ce=N(ae,[["__file","F:/inf/Yearning/gemini-next/src/views/manager/policy/policy.vue"]]);export{ce as default};
